<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.0.6" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.0.6">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.0.6">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.0.6">


  <link rel="mask-icon" href="/images/logo.svg?v=6.0.6" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.0.6',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="BackgroundThe latest openocd we can get from the apt repository of Raspberry Pi is only up to 0.9.0 as of writing. I’d like to use my Raspberry Pi to download FPGA bit file, but openocd 0.9.0 has some">
<meta property="og:type" content="article">
<meta property="og:title" content="Compile openocd for ARM platform">
<meta property="og:url" content="http://pansila.github.io/posts/233799e4/index.html">
<meta property="og:site_name" content="Fantasy and Fiction">
<meta property="og:description" content="BackgroundThe latest openocd we can get from the apt repository of Raspberry Pi is only up to 0.9.0 as of writing. I’d like to use my Raspberry Pi to download FPGA bit file, but openocd 0.9.0 has some">
<meta property="og:updated_time" content="2018-05-11T09:10:20.985Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Compile openocd for ARM platform">
<meta name="twitter:description" content="BackgroundThe latest openocd we can get from the apt repository of Raspberry Pi is only up to 0.9.0 as of writing. I’d like to use my Raspberry Pi to download FPGA bit file, but openocd 0.9.0 has some">






  <link rel="canonical" href="http://pansila.github.io/posts/233799e4/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Compile openocd for ARM platform | Fantasy and Fiction</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> 

<div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Fantasy and Fiction</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        
          
  <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
</li>

      
        
        
          
  <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives</a>
</li>

      

      
    </ul>
  

  

  
</nav>


  



 </div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pansila.github.io/posts/233799e4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pansila">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fantasy and Fiction">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Compile openocd for ARM platform</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-11T16:11:20+08:00">2018-05-11</time>
            

            
            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/233799e4/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments:</span> <span class="post-comments-count valine-comment-count" data-xid="/posts/233799e4/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p>The latest openocd we can get from the apt repository of Raspberry Pi is only up to 0.9.0 as of writing. I’d like to use my Raspberry Pi to download FPGA bit file, but openocd 0.9.0 has some problem to support jlink debugger. See errors below if it’s like your case.<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Pi@Raspberrypi:~/openocd-workdir $ /usr/bin/openocd -f <span class="keyword">interface</span>/jlink.cfg -f xilinx-xc6v.cfg -f openocd-xc6v.cfg</span><br><span class="line">Open On-Chip Debugger <span class="number">0.9</span>.<span class="number">0</span> (<span class="number">2018</span>-<span class="number">01</span>-<span class="number">22</span>-<span class="number">06</span>:<span class="number">14</span>)</span><br><span class="line">Licensed under GNU GPL v2</span><br><span class="line"><span class="keyword">For</span> bug reports, read</span><br><span class="line">        http://openocd.org/doc/doxygen/bugs.html</span><br><span class="line">Info : <span class="type">auto</span>-selecting first available session transport <span class="string">"jtag"</span>. To override <span class="keyword">use</span> <span class="symbol">'transport</span> <span class="keyword">select</span> &lt;transport&gt;'.</span><br><span class="line">xc6v_program_iprog</span><br><span class="line">adapter speed: <span class="number">5000</span> kHz</span><br><span class="line">Info : <span class="type">J</span>-Link ARM V8 compiled May <span class="number">27</span> <span class="number">2009</span> <span class="number">17</span>:<span class="number">31</span>:<span class="number">22</span></span><br><span class="line">Info : <span class="type">J</span>-Link caps <span class="number">0</span>xb9ff7bbf</span><br><span class="line">Info : <span class="type">J</span>-Link hw version <span class="number">80000</span></span><br><span class="line">Info : <span class="type">J</span>-Link hw <span class="keyword">type</span> <span class="type">J-Link</span></span><br><span class="line"><span class="type">Info </span>: J-Link max mem block <span class="number">9752</span></span><br><span class="line">Info : <span class="type">J</span>-Link configuration</span><br><span class="line">Info : <span class="type">USB</span>-Address: <span class="number">0</span>x0</span><br><span class="line">Info : <span class="type">Kickstart</span> power on JTAG-pin <span class="number">19</span>: <span class="number">0</span>xffffffff</span><br><span class="line">Info : <span class="type">Vref</span> = <span class="number">2.523</span> TCK = <span class="number">1</span> TDI = <span class="number">0</span> TDO = <span class="number">1</span> TMS = <span class="number">0</span> SRST = <span class="number">1</span> TRST = <span class="number">1</span></span><br><span class="line">Info : <span class="type">J</span>-Link JTAG <span class="keyword">Interface</span> ready</span><br><span class="line">Info : <span class="type">clock</span> speed <span class="number">5000</span> kHz</span><br><span class="line">Info : <span class="type">JTAG</span> tap: xc6v.tap tap/device found: <span class="number">0</span>x84250093 (mfg: <span class="number">0</span>x049, part: <span class="number">0</span>x4250, ver: <span class="number">0</span>x8)</span><br><span class="line">Warn : <span class="type">gdb</span> services need one <span class="keyword">or</span> more targets defined</span><br><span class="line">openocd: jlink.c:<span class="number">1474</span>: jlink_tap_append_step: Assertion `index_var &lt; JLINK_TAP_BUFFER_SIZE' failed.</span><br><span class="line">Aborted</span><br></pre></td></tr></table></figure></p>
<p>Howerver, it works well on the PC with the openocd 0.10.0 from <a href="https://gnu-mcu-eclipse.github.io/openocd/" target="_blank" rel="noopener">GNU MCU Eclipse OpenOCD</a>, so I decided to compile it for my Raspberry Pi.</p>
<p>Unfortunately, GNU MCU Eclipse OpenOCD doesn’t support compiling for arm, after some searching on the web, I found an openocd build <a href="https://github.com/arduino/OpenOCD-build-script" target="_blank" rel="noopener">repository</a> for Arduino which bundled all necessary libraries for building. The openocd included is a bit of old, we can replace it with the latest one.</p>
<h2 id="Cross-Compiling"><a href="#Cross-Compiling" class="headerlink" title="Cross Compiling"></a>Cross Compiling</h2><ol>
<li><p>Check out the latest openocd code</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="keyword">clone</span> <span class="title">git</span>://git.code.sf.net/p/openocd/code openocd</span><br></pre></td></tr></table></figure>
</li>
<li><p>Check out the openocd build script</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="keyword">clone</span> <span class="title">https</span>://github.com/arduino/OpenOCD-build-script.git openocd-build</span><br></pre></td></tr></table></figure>
</li>
<li><p>Copy it to the build folder, replace the original <code>OpenOCD</code> folder</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mv openocd-build/OpenOCD&#123;,-old&#125;</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cp openocd openocd-build/OpenOCD -r</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Add the cross compile arguments in the <code>compile_unix_openocd.sh</code></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.</span></span><br><span class="line"><span class="attr">ARCH</span>=`gcc -v <span class="number">2</span>&gt;&amp;<span class="number">1</span> | awk <span class="string">'/Target/ &#123; print $2 &#125;'</span>`</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add two new arguments, check uname -m for your build PC's architecture</span></span><br><span class="line"><span class="attr">BUILD</span>=<span class="string">"x86_64-pc-linux-gnu"</span></span><br><span class="line"><span class="attr">HOST</span>=<span class="string">"arm-linux-gnueabihf"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Append the cross compile flags to all configuration steps, like this</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">./configure</span> <span class="params">--enable-static</span> <span class="params">--disable-shared</span> <span class="params">--disable-blkid</span> <span class="params">--disable-kmod</span>  <span class="params">--disable-manpages</span> <span class="params">--host=</span>$HOST <span class="params">--build=</span>$BUILD</span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Build it, install any missed packages if the build process reports, like gperf</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./compile_unix_openocd.sh</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>However the binary generated this way is failed to run on the raspberry pi with a segment fault, not sure why. Instead, I went for a native building.</p>
<h2 id="Native-Compiling-On-Raspberry-Pi"><a href="#Native-Compiling-On-Raspberry-Pi" class="headerlink" title="Native Compiling On Raspberry Pi"></a>Native Compiling On Raspberry Pi</h2><p>Nothing need to change except updating the OpenOCD code. The new generated openocd solved the problem in the first place.</p>

      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/posts/67d7a1ab/" rel="next" title="Use OpenOCD to program FPGA for Xilinx Virtex-6 XC6 Series">
                <i class="fa fa-chevron-left"></i> Use OpenOCD to program FPGA for Xilinx Virtex-6 XC6 Series
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Pansila</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">21</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Background"><span class="nav-number">1.</span> <span class="nav-text">Background</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cross-Compiling"><span class="nav-number">2.</span> <span class="nav-text">Cross Compiling</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Native-Compiling-On-Raspberry-Pi"><span class="nav-number">3.</span> <span class="nav-text">Native Compiling On Raspberry Pi</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate"> 
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Pansila</span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Gemini</a> v6.0.6</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.0.6"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.0.6"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.0.6"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.0.6"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.0.6"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.0.6"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.6"></script>



  



	





  





  








  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  
  
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(function (item) {
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'qBTseCeEXIm7y4BLwe05EVy9-gzGzoHsz',
        appKey: 'Vo7kIJagaWoBbHKtppisGPj0',
        placeholder: 'Just go go',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  

  

  

  
  

  

  

  

  

</body>
</html>
