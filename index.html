<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.0.6" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.0.6">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.0.6">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.0.6">


  <link rel="mask-icon" href="/images/logo.svg?v=6.0.6" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.0.6',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="Fantasy and Fiction">
<meta property="og:url" content="http://pansila.github.io/index.html">
<meta property="og:site_name" content="Fantasy and Fiction">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Fantasy and Fiction">






  <link rel="canonical" href="http://pansila.github.io/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Fantasy and Fiction</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> 

<div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Fantasy and Fiction</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        
          
  <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
</li>

      
        
        
          
  <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives</a>
</li>

      

      
    </ul>
  

  

  
</nav>


  



 </div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pansila.github.io/posts/233799e4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pansila">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fantasy and Fiction">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/233799e4/" itemprop="url">Compile openocd for ARM platform</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-11T16:11:20+08:00">2018-05-11</time>
            

            
            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/233799e4/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments:</span> <span class="post-comments-count valine-comment-count" data-xid="/posts/233799e4/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p>The latest openocd we can get from the apt repository of Raspberry Pi is only up to 0.9.0 as of writing. I’d like to use my Raspberry Pi to download FPGA bit file, but openocd 0.9.0 has some problem to support jlink debugger. See errors below if it’s like your case.<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Pi@Raspberrypi:~/openocd-workdir $ /usr/bin/openocd -f <span class="keyword">interface</span>/jlink.cfg -f xilinx-xc6v.cfg -f openocd-xc6v.cfg</span><br><span class="line">Open On-Chip Debugger <span class="number">0.9</span>.<span class="number">0</span> (<span class="number">2018</span>-<span class="number">01</span>-<span class="number">22</span>-<span class="number">06</span>:<span class="number">14</span>)</span><br><span class="line">Licensed under GNU GPL v2</span><br><span class="line"><span class="keyword">For</span> bug reports, read</span><br><span class="line">        http://openocd.org/doc/doxygen/bugs.html</span><br><span class="line">Info : <span class="type">auto</span>-selecting first available session transport <span class="string">"jtag"</span>. To override <span class="keyword">use</span> <span class="symbol">'transport</span> <span class="keyword">select</span> &lt;transport&gt;'.</span><br><span class="line">xc6v_program_iprog</span><br><span class="line">adapter speed: <span class="number">5000</span> kHz</span><br><span class="line">Info : <span class="type">J</span>-Link ARM V8 compiled May <span class="number">27</span> <span class="number">2009</span> <span class="number">17</span>:<span class="number">31</span>:<span class="number">22</span></span><br><span class="line">Info : <span class="type">J</span>-Link caps <span class="number">0</span>xb9ff7bbf</span><br><span class="line">Info : <span class="type">J</span>-Link hw version <span class="number">80000</span></span><br><span class="line">Info : <span class="type">J</span>-Link hw <span class="keyword">type</span> <span class="type">J-Link</span></span><br><span class="line"><span class="type">Info </span>: J-Link max mem block <span class="number">9752</span></span><br><span class="line">Info : <span class="type">J</span>-Link configuration</span><br><span class="line">Info : <span class="type">USB</span>-Address: <span class="number">0</span>x0</span><br><span class="line">Info : <span class="type">Kickstart</span> power on JTAG-pin <span class="number">19</span>: <span class="number">0</span>xffffffff</span><br><span class="line">Info : <span class="type">Vref</span> = <span class="number">2.523</span> TCK = <span class="number">1</span> TDI = <span class="number">0</span> TDO = <span class="number">1</span> TMS = <span class="number">0</span> SRST = <span class="number">1</span> TRST = <span class="number">1</span></span><br><span class="line">Info : <span class="type">J</span>-Link JTAG <span class="keyword">Interface</span> ready</span><br><span class="line">Info : <span class="type">clock</span> speed <span class="number">5000</span> kHz</span><br><span class="line">Info : <span class="type">JTAG</span> tap: xc6v.tap tap/device found: <span class="number">0</span>x84250093 (mfg: <span class="number">0</span>x049, part: <span class="number">0</span>x4250, ver: <span class="number">0</span>x8)</span><br><span class="line">Warn : <span class="type">gdb</span> services need one <span class="keyword">or</span> more targets defined</span><br><span class="line">openocd: jlink.c:<span class="number">1474</span>: jlink_tap_append_step: Assertion `index_var &lt; JLINK_TAP_BUFFER_SIZE' failed.</span><br><span class="line">Aborted</span><br></pre></td></tr></table></figure></p>
<p>Howerver, it works well on the PC with the openocd 0.10.0 from <a href="https://gnu-mcu-eclipse.github.io/openocd/" target="_blank" rel="noopener">GNU MCU Eclipse OpenOCD</a>, so I decided to compile it for my Raspberry Pi.</p>
<p>Unfortunately, GNU MCU Eclipse OpenOCD doesn’t support compiling for arm, after some searching on the web, I found an openocd build <a href="https://github.com/arduino/OpenOCD-build-script" target="_blank" rel="noopener">repository</a> for Arduino which bundled all necessary libraries for building. The openocd included is a bit of old, we can replace it with the latest one.</p>
<h2 id="Cross-Compiling"><a href="#Cross-Compiling" class="headerlink" title="Cross Compiling"></a>Cross Compiling</h2><ol>
<li><p>Check out the latest openocd code</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="keyword">clone</span> <span class="title">git</span>://git.code.sf.net/p/openocd/code openocd</span><br></pre></td></tr></table></figure>
</li>
<li><p>Check out the openocd build script</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="keyword">clone</span> <span class="title">https</span>://github.com/arduino/OpenOCD-build-script.git openocd-build</span><br></pre></td></tr></table></figure>
</li>
<li><p>Copy it to the build folder, replace the original <code>OpenOCD</code> folder</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mv openocd-build/OpenOCD&#123;,-old&#125;</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cp openocd openocd-build/OpenOCD -r</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Add the cross compile arguments in the <code>compile_unix_openocd.sh</code></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.</span></span><br><span class="line"><span class="attr">ARCH</span>=`gcc -v <span class="number">2</span>&gt;&amp;<span class="number">1</span> | awk <span class="string">'/Target/ &#123; print $2 &#125;'</span>`</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add two new arguments, check uname -m for your build PC's architecture</span></span><br><span class="line"><span class="attr">BUILD</span>=<span class="string">"x86_64-pc-linux-gnu"</span></span><br><span class="line"><span class="attr">HOST</span>=<span class="string">"arm-linux-gnueabihf"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Append the cross compile flags to all configuration steps, like this</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">./configure</span> <span class="params">--enable-static</span> <span class="params">--disable-shared</span> <span class="params">--disable-blkid</span> <span class="params">--disable-kmod</span>  <span class="params">--disable-manpages</span> <span class="params">--host=</span>$HOST <span class="params">--build=</span>$BUILD</span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Build it, install any missed packages if the build process reports, like gperf</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./compile_unix_openocd.sh</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>However the binary generated this way is failed to run on the raspberry pi with a segment fault, not sure why. Instead, I went for a native building.</p>
<h2 id="Native-Compiling-On-Raspberry-Pi"><a href="#Native-Compiling-On-Raspberry-Pi" class="headerlink" title="Native Compiling On Raspberry Pi"></a>Native Compiling On Raspberry Pi</h2><p>Nothing need to change except updating the OpenOCD code. The new generated openocd solved the problem in the first place.</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pansila.github.io/posts/67d7a1ab/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pansila">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fantasy and Fiction">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/67d7a1ab/" itemprop="url">Use OpenOCD to program FPGA for Xilinx Virtex-6 XC6 Series</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-04T14:18:53+08:00">2018-05-04</time>
            

            
            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/67d7a1ab/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments:</span> <span class="post-comments-count valine-comment-count" data-xid="/posts/67d7a1ab/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><em>Note: Currently it’s only tested for Virtex-6 XC6VLX240T, suppose to be able to extend for more virtext-6 FPGAs</em></p>
<h2 id="Work-Environment"><a href="#Work-Environment" class="headerlink" title="Work Environment"></a>Work Environment</h2><ol>
<li>Windows 7 64bit</li>
<li><a href="https://www.xilinx.com/products/boards-and-kits/ek-v6-ml605-g.html" target="_blank" rel="noopener">Xilinx Virtex-6 FPGA ML605 Evaluation Kit</a><br><img src="https://i.loli.net/2018/05/04/5aebfeb3647e0.jpg" alt=""></li>
</ol>
<h2 id="Installation-Guide"><a href="#Installation-Guide" class="headerlink" title="Installation Guide"></a>Installation Guide</h2><ol>
<li>Unzip the <a href="https://github.com/gnu-mcu-eclipse/openocd/releases" target="_blank" rel="noopener">OpenOCD binary zip file</a> to anywhere you’re used to put a tool, like <code>d:\tools\</code></li>
<li><p>Add the OpenOCD executable path to the <code>PATH</code> environment, reboot or logout to put it into effect</p>
<p> <em>Note: if you’re using <code>cmder</code>, we can make it without a rebooting</em></p>
<ul>
<li>Go to Setting-&gt;Startup-&gt;Environment</li>
<li>Set the <code>PATH</code> environment: <code>set PATH=D:\tools\openocd\bin;%PATH%</code></li>
<li>Open a new console to load the new environments</li>
</ul>
</li>
<li><p>Install USB JTAG cable driver<br>The adapter DLC9G that comes with Xilinx Virtex-6 Evaluation Kit is not supported by OpenOCD due to its proprietary protocol, here we’ll use jlink instead.</p>
<ul>
<li>Download <a href="http://zadig.akeo.ie/" target="_blank" rel="noopener">zadig</a></li>
<li>Go to Options-&gt;List All devices</li>
<li>Select the jlink device, vid: 1366, pid: 0101</li>
<li><p>Click “Replace Driver”.</p>
<p><img src="https://i.loli.net/2018/05/04/5aebff31927f0.jpg" alt=""></p>
</li>
<li><p>Jumper wiring jlink pins to jtags pins on board</p>
<p><img src="https://i.loli.net/2018/05/04/5aec028dd3c0e.jpg" alt=""><br><img src="https://i.loli.net/2018/05/04/5aec02c03db0d.jpg" alt=""></p>
</li>
</ul>
</li>
</ol>
<h2 id="Programming"><a href="#Programming" class="headerlink" title="Programming"></a>Programming</h2><ol>
<li><p>Put the OpenOCD <a href="#openocd-configuration">configuration</a> file in the work dir together with the bit file (file content attached at the end).</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> d:\workdir</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> dir</span></span><br><span class="line">openocd-xc6v.cfg</span><br><span class="line">xilinx-xc6v.cfg</span><br><span class="line">bitstream.bit</span><br></pre></td></tr></table></figure>
</li>
<li><p>Modify the path to the bit file in the configuration</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">init</span><br><span class="line">xc6v_program xc6v.tap</span><br><span class="line">pld load <span class="number">0</span> bitstream.bit   <span class="comment">#### this one ####</span></span><br><span class="line"><span class="keyword">exit</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
<li><p>Run openocd in the cmd.exe or a cmder console</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openocd -f interface/jlink<span class="selector-class">.cfg</span> -f xilinx-xc6v<span class="selector-class">.cfg</span> -f openocd-xc6v.cfg</span><br></pre></td></tr></table></figure>
</li>
<li><p>Waiting for the programming done if no error raised</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ openocd -f interface/jlink.cfg -f xilinx-xc6v.cfg -f openocd-xc6v.cfg</span><br><span class="line">GNU MCU Eclipse 64-bits Open On-Chip Debugger 0.10.0+dev-00404-g20463c28 (2018-01-23-12:30)</span><br><span class="line">Licensed under GNU GPL v2</span><br><span class="line">For bug reports, <span class="built_in">read</span></span><br><span class="line">        http://openocd.org/doc/doxygen/bugs.html</span><br><span class="line">Info : auto-selecting first available session transport <span class="string">"jtag"</span>. To override use <span class="string">'transport select &lt;transport&gt;'</span>.</span><br><span class="line">xc6_program_iprog</span><br><span class="line">adapter speed: 5000 kHz</span><br><span class="line">Info : J-Link ARM V8 compiled May 27 2009 17:31:22</span><br><span class="line">Info : Hardware version: 8.00</span><br><span class="line">Info : VTarget = 2.478 V</span><br><span class="line">Info : clock speed 5000 kHz</span><br><span class="line">Info : JTAG tap: xc6.tap tap/device found: 0x84250093 (mfg: 0x049 (Xilinx), part: 0x4250, ver: 0x8)</span><br><span class="line">Warn : gdb services need one or more targets defined</span><br><span class="line">loaded file bitstream.bit to pld device 0 <span class="keyword">in</span> 46s 322000us</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h2 id="OpenOCD-Configuration-openocd-xc6v-cfg"><a href="#OpenOCD-Configuration-openocd-xc6v-cfg" class="headerlink" title="OpenOCD Configuration (openocd-xc6v.cfg)"></a>OpenOCD Configuration (openocd-xc6v.cfg)</h2><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">adapter_khz <span class="number">5000</span></span><br><span class="line"></span><br><span class="line">init</span><br><span class="line">xc6v_program xc6v.tap</span><br><span class="line">pld <span class="keyword">load</span> <span class="number">0</span> bitstream.bit</span><br><span class="line"><span class="keyword">exit</span></span><br></pre></td></tr></table></figure>
<h2 id="OpenOCD-Target-Configuration-xilinx-xc6v-cfg"><a href="#OpenOCD-Target-Configuration-xilinx-xc6v-cfg" class="headerlink" title="OpenOCD Target Configuration (xilinx-xc6v.cfg)"></a>OpenOCD Target Configuration (xilinx-xc6v.cfg)</h2><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> &#123; [<span class="keyword">info</span> exists CHIPNAME] &#125; &#123;</span><br><span class="line">	<span class="keyword">set</span> _CHIPNAME $CHIPNAME</span><br><span class="line">&#125; else &#123;</span><br><span class="line">	<span class="keyword">set</span> _CHIPNAME xc6v</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> XC6V_CFG_IN <span class="number">0x05</span></span><br><span class="line"><span class="keyword">set</span> XC6V_JSHUTDOWN <span class="number">0x0d</span></span><br><span class="line"><span class="keyword">set</span> XC6V_JPROGRAM <span class="number">0x0b</span></span><br><span class="line"><span class="keyword">set</span> XC6V_JSTART <span class="number">0x0c</span></span><br><span class="line"><span class="keyword">set</span> XC6V_BYPASS <span class="number">0x3f</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Device ID Code IR Length Part Name</span></span><br><span class="line"><span class="comment"># 84250093 10 XC6VLX240T</span></span><br><span class="line"><span class="comment"># 44244093 10 XC6VLX75T</span></span><br><span class="line"><span class="comment"># c2a96093 10 XC6VLX50T</span></span><br><span class="line"><span class="comment"># 442a8093 10 XC6VHX380T</span></span><br><span class="line"></span><br><span class="line">jtag newtap $_CHIPNAME tap -irlen <span class="number">10</span> -ignore-version \</span><br><span class="line">	-expected-id <span class="number">0x84250093</span></span><br><span class="line">pld device virtex2 $_CHIPNAME.tap</span><br><span class="line"></span><br><span class="line"><span class="keyword">proc</span><span class="title"> xc6v_program</span> &#123;tap&#125; &#123;</span><br><span class="line">	<span class="keyword">global</span> XC6V_JSHUTDOWN XC6V_JPROGRAM XC6V_JSTART XC6V_BYPASS</span><br><span class="line">	irscan $tap $XC6V_JSHUTDOWN</span><br><span class="line">	irscan $tap $XC6V_JPROGRAM</span><br><span class="line">	irscan $tap $XC6V_JSTART</span><br><span class="line">	irscan $tap $XC6V_BYPASS</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pansila.github.io/posts/7db4884d/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pansila">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fantasy and Fiction">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/7db4884d/" itemprop="url">Use OpenOCD to program FPGA for Xilinx Virtex XC7 Series</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-02T14:19:26+08:00">2018-04-02</time>
            

            
            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/7db4884d/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments:</span> <span class="post-comments-count valine-comment-count" data-xid="/posts/7db4884d/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Work-Environment"><a href="#Work-Environment" class="headerlink" title="Work Environment"></a>Work Environment</h2><ol>
<li>Windows 7 64bit</li>
<li><a href="https://www.xilinx.com/products/boards-and-kits/dk-v7-vc709-g.html" target="_blank" rel="noopener">Xilinx Virtex-7 FPGA VC709 Connectivity Kit</a><br><img src="https://i.loli.net/2018/04/02/5ac1cd20310a8.jpg" alt=""></li>
</ol>
<h2 id="Installation-Guide"><a href="#Installation-Guide" class="headerlink" title="Installation Guide"></a>Installation Guide</h2><ol>
<li>Unzip the <a href="https://github.com/gnu-mcu-eclipse/openocd/releases" target="_blank" rel="noopener">OpenOCD binary zip file</a> to anywhere you’re used to put a tool, like <code>d:\tools\</code></li>
<li><p>Add the OpenOCD executable path to the <code>PATH</code> environment, reboot or logout to put it into effect</p>
<p> <em>Note: if you’re using <code>cmder</code>, we can make it without a rebooting</em></p>
<ul>
<li>Go to Setting-&gt;Startup-&gt;Environment</li>
<li>Set the <code>PATH</code> environment: <code>set PATH=D:\tools\openocd\bin;%PATH%</code></li>
<li>Open a new console to load the new environments</li>
</ul>
</li>
<li><p>Install USB JTAG cable driver</p>
<ul>
<li>Download <a href="http://zadig.akeo.ie/" target="_blank" rel="noopener">zadig</a></li>
<li>Go to Options-&gt;List All devices</li>
<li>Select the first cable port (interface 0 or Port A), vid: 0403, pid: 6010</li>
<li><p>Click “Replace Driver”.</p>
<p><img src="https://i.loli.net/2018/04/02/5ac1cbc3a84f6.png" alt=""></p>
</li>
</ul>
</li>
</ol>
<h2 id="Programming"><a href="#Programming" class="headerlink" title="Programming"></a>Programming</h2><p>   Target Xilinx Virtex XC7 series as of now</p>
<ol>
<li><p>Put the OpenOCD <a href="#openocd-configuration">configuration</a> file in the work dir together with the bit file (file content attached at the end).</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> d:\workdir</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> dir</span></span><br><span class="line">openocd.cfg</span><br><span class="line">a-bit-file.bit</span><br></pre></td></tr></table></figure>
</li>
<li><p>Modify the path to the bit file in the configuration</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">init</span><br><span class="line">xc7_program xc7.tap</span><br><span class="line">pld load <span class="number">0</span> a-bit-file.bit   <span class="comment">#### this one ####</span></span><br><span class="line"><span class="keyword">exit</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
<li><p>Run openocd in the cmd.exe or a cmder console</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> openocd --<span class="built_in">command</span> <span class="string">"tcl_port disabled"</span> --<span class="built_in">command</span> <span class="string">"telnet_port disabled"</span></span></span><br></pre></td></tr></table></figure>
<p>If the configuration file is not in the current work directory, we can specifiy it in the command line</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> openocd -f &lt;path_to_config&gt; --<span class="built_in">command</span> <span class="string">"tcl_port disabled"</span> --<span class="built_in">command</span> <span class="string">"telnet_port disabled"</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Waiting for the programming done if no error raised</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ openocd</span><br><span class="line">GNU MCU Eclipse 64-bits Open On-Chip Debugger 0.10.0+dev-00404-g20463c28 (2018-01-23-12:30)</span><br><span class="line">Licensed under GNU GPL v2</span><br><span class="line">For bug reports, <span class="built_in">read</span></span><br><span class="line">        http://openocd.org/doc/doxygen/bugs.html</span><br><span class="line">none separate</span><br><span class="line">Info : auto-selecting first available session transport <span class="string">"jtag"</span>. To override use <span class="string">'transport select &lt;transport&gt;'</span>.</span><br><span class="line">adapter speed: 25000 kHz</span><br><span class="line">Info : ftdi: <span class="keyword">if</span> you experience problems at higher adapter clocks, try the <span class="built_in">command</span> <span class="string">"ftdi_tdo_sample_edge falling"</span></span><br><span class="line">Info : clock speed 25000 kHz</span><br><span class="line">Info : JTAG tap: xc7.tap tap/device found: 0x33691093 (mfg: 0x049 (Xilinx), part: 0x3691, ver: 0x3)</span><br><span class="line">Warn : gdb services need one or more targets defined</span><br><span class="line">loaded file a-bit-file.bit to pld device 0 <span class="keyword">in</span> 16s 603000us</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h2 id="OpenOCD-Configuration"><a href="#OpenOCD-Configuration" class="headerlink" title="OpenOCD Configuration"></a>OpenOCD Configuration</h2><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">source</span> [find interface/ftdi/digilent-hs1.cfg]</span><br><span class="line"><span class="keyword">source</span> [find cpld/xilinx-xc7.cfg]</span><br><span class="line"><span class="comment">#source [find cpld/jtagspi.cfg]</span></span><br><span class="line">adapter_khz <span class="number">25000</span></span><br><span class="line"></span><br><span class="line">init</span><br><span class="line">xc7_program xc7.tap</span><br><span class="line">pld <span class="keyword">load</span> <span class="number">0</span> a-bit-<span class="keyword">file</span>.bit</span><br><span class="line"><span class="keyword">exit</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## programming SPI Flash</span></span><br><span class="line"><span class="comment"># init</span></span><br><span class="line"><span class="comment"># jtagspi_init 0 xc7_bscan_spi.bit</span></span><br><span class="line"><span class="comment"># jtagspi_program a-bit-file.bit 0</span></span><br><span class="line"><span class="comment"># xc7_program xc7.tap</span></span><br><span class="line"><span class="comment"># pld load 0 a-bit-file.bit</span></span><br><span class="line"><span class="comment"># exit</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pansila.github.io/posts/ae66dec5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pansila">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fantasy and Fiction">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/ae66dec5/" itemprop="url">Cross compile mongodb for 32 bit arm</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-23T23:06:10+08:00">2018-03-23</time>
            

            
            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/ae66dec5/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments:</span> <span class="post-comments-count valine-comment-count" data-xid="/posts/ae66dec5/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>I’d like to run a relatively modern mongodb server on my cubieboard which is powered by an ARMv7l chip. There was a good <a href="http://facat.github.io/cross-compile-mongodb-for-arm.html" target="_blank" rel="noopener">work</a> but it was built against 2.6.3 thus a bit out-dated. The latest version of mongodb that supports 32 bit platform is 3.3.15. That’s what I’d like to try here.</p>
<ol>
<li><p>Prepare the build environment</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install build-essential wget scons</span><br><span class="line">$ sudo apt-get install libboost-filesystem-dev libboost-program-options-dev libboost-system-dev libboost-thread-dev</span><br><span class="line">$ sudo apt-get install g++-5-arm-linux-gnueabihf g++-5-arm-linux-gnueabihf</span><br></pre></td></tr></table></figure>
</li>
<li><p>You might need to update the cross-compile toolchain accordingly to make <code>arm-linux-gnueabihf-gcc</code> point to the correct version, details see this <a href="posts/14894ce3/">post</a>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo update-alternatives --install /usr/bin/arm-linux-gnueabihf-gcc arm-linux-gnueabihf-gcc /usr/bin/arm-linux-gnueabihf-gcc-5 100 --slave /usr/bin/arm-linux-gnueabihf-g++ arm-linux-gnueabihf-g++ /usr/bin/arm-linux-gnueabihf-g++-5</span><br></pre></td></tr></table></figure>
</li>
<li><p>Download and unpack mongodb source code</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir install</span><br><span class="line">$ <span class="built_in">cd</span> install</span><br><span class="line">$ wget https://fastdl.mongodb.org/src/mongodb-src-r3.3.15.tar.gz</span><br><span class="line">$ tar xvf mongodb-src-r3.3.15.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> mongodb-src-r3.3.15</span><br></pre></td></tr></table></figure>
</li>
<li><p>Generate additional sources. It’s suggested by <a href="https://groups.google.com/forum/#!msg/mongodb-dev/G-kGjZEEam0/VSVB9fYCBAAJ" target="_blank" rel="noopener">this post</a>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> src/third_party/mozjs-45/</span><br><span class="line">$ ./get_sources.sh</span><br><span class="line">$ ./gen-config.sh arm linux</span><br><span class="line">$ <span class="built_in">cd</span> -</span><br></pre></td></tr></table></figure>
<p>As I was doing it, an error raised saying a file missed.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fatal error: js-config.h: No such file or directory</span><br></pre></td></tr></table></figure>
<p>Therefore some extra parameters were added in the file <code>gen-config.sh</code> to fix it.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PYTHON=python ./configure --without-intl-api --<span class="built_in">enable</span>-posix-nspr-emulation --<span class="built_in">disable</span>-trace-logging --host=arm-linux --target=arm-linux-gnueabihf --build=x86_64-linux</span><br></pre></td></tr></table></figure>
</li>
<li><p>More modifications to move on.</p>
<ul>
<li><p>No pause implementation.</p>
<p>Error message:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In file included from src/mongo/util/concurrency/spin_lock.cpp:34:0:</span><br><span class="line">src/mongo/platform/pause.h:71:2: error: <span class="comment">#error "No processor pause implementation for this architecture."</span></span><br><span class="line"> <span class="comment">#error "No processor pause implementation for this architecture."</span></span><br><span class="line">src/mongo/util/concurrency/spin_lock.cpp: In member <span class="keyword">function</span> <span class="string">'void mongo::SpinLock::_lockSlowPath()'</span>:</span><br><span class="line">src/mongo/util/concurrency/spin_lock.cpp:57:34: error: <span class="string">'MONGO_YIELD_CORE_FOR_SMT'</span> was not declared <span class="keyword">in</span> this scope</span><br><span class="line">    MONGO_YIELD_CORE_FOR_SMT();</span><br></pre></td></tr></table></figure>
<p>Modification:</p>
<p>mongo uses some processor pause signal to make CPU work more effectively, arm (armv7l) is out of support in this case, add it along with aarch64 in the file <code>src/mongo/platform/pause.h</code>.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined(__aarch64) || defined(__arm__)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MONGO_YIELD_CORE_FOR_SMT() __asm__ volatile(<span class="meta-string">"yield"</span> ::: <span class="meta-string">"memory"</span>)</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>config.h</code> missing for gperftools 2.5</p>
<p>Error message:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">src/third_party/gperftools-2.5/src/base/dynamic_annotations.c:38:20: fatal error: config.h: No such file or directory</span><br></pre></td></tr></table></figure>
<p>Modification:</p>
<p>The missed file is generated by <code>./configure</code>, download a gperftools source code.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://github.com/gperftools/gperftools/releases/download/gperftools-2.5/gperftools-2.5.tar.gz</span><br><span class="line">$ tar xf gperftools-2.5.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> gperftools-2.5</span><br><span class="line">$ ./configure --target=arm-linux-gnueabihf --host=arm-linux --build=x86_64-linux</span><br></pre></td></tr></table></figure>
<p>Find the file in the path <code>src/config.h</code>, copy it to the mongo third party directory <code>src/third_party/gperftools-2.5/build_linux_arm</code>.</p>
</li>
<li><p><code>--std=c++11</code> issue when compiling gperftools 2.5</p>
<p>Error message:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">src/base/linux_syscall_support.h: In <span class="keyword">function</span> ‘pid_t sys_getpid()’:</span><br><span class="line">src/base/linux_syscall_support.h:1304:33: error: expected string-literal before ‘:’ token</span><br><span class="line">                            : <span class="string">"lr"</span>, <span class="string">"memory"</span>);</span><br></pre></td></tr></table></figure>
<p>Modification:</p>
<p>It’s a problem reported <a href="https://github.com/gperftools/gperftools/issues/670" target="_blank" rel="noopener">here</a> and fixed <a href="https://github.com/larsla/mongo/commit/9745d756e604dc6f31abe72bcc1d23ad3e3c65af#diff-cc8093822b396591a5530a463c87d048" target="_blank" rel="noopener">here</a>. Use gnu++11 instead of c++11 in the top level SConstruct of mongodb.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> AddToCXXFLAGSIfSupported(myenv, <span class="string">'-std=gnu++11'</span>):</span><br><span class="line">   myenv.ConfError(<span class="string">'Compiler does not honor -std=gnu++11'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>call of overloaded <code>appendNumber</code> is ambitious</p>
<p>Error message:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">src/mongo/util/procparser.cpp: In <span class="keyword">function</span> <span class="string">'mongo::Status mongo::procparser::parseProcStat(const std::vector&lt;mongo::StringData&gt;&amp;, mongo::StringData, int64_t, mongo::BSONObjBuilder*)'</span>:</span><br><span class="line">src/mongo/util/procparser.cpp:281:49: error: call of overloaded <span class="string">'appendNumber(mongo::StringData&amp;, uint64_t&amp;)'</span> is ambiguous</span><br><span class="line">              builder-&gt;appendNumber(key, value);</span><br><span class="line">                                              ^</span><br><span class="line">In file included from src/mongo/util/procparser.cpp:51:0:</span><br></pre></td></tr></table></figure>
<p>Modification:</p>
<p>Change the argument type from <code>uint64_t</code> to <code>long long</code> for all calls of appendNumber, details see <a href="http://patches.linaro.org/patch/111505/" target="_blank" rel="noopener">here</a>.</p>
</li>
</ul>
</li>
<li><p>Compile and build.</p>
<p>WiredTiger will not work on a 32 bit architecture so you will encounter some compilation challenges with it. It is recommended to simply exclude the WiredTiger storage engine altogether. That means you will run MongoDB with the MMAPv1 storage engine only. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ scons mongo mongod --wiredtiger=off --mmapv1=on CC=arm-linux-gnueabihf-gcc CXX=arm-linux-gnueabihf-g++</span><br></pre></td></tr></table></figure>
</li>
<li><p>Reduce binaries file size.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ strip -s build/opt/mongo</span><br><span class="line">$ strip -s build/opt/mongod</span><br></pre></td></tr></table></figure>
</li>
<li><p>Install binaries</p>
<p>Copy all the binaries to the cubieboard.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo cp mongo mongod /usr/<span class="built_in">local</span>/bin/</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="Binary-Provided"><a href="#Binary-Provided" class="headerlink" title="Binary Provided"></a>Binary Provided</h2><p>I have compiled MongoDB 3.3.15 for ARM. You can <a href="download/mongodb-r3.3.15.tar.gz">DOWNLOAD</a> it.</p>
<hr>
<p>Credits:</p>
<ul>
<li><a href="http://koenaerts.ca/compile-and-install-mongodb-on-raspberry-pi/" target="_blank" rel="noopener">Compile and install MongoDB on Raspberry PI</a></li>
<li><a href="http://facat.github.io/cross-compile-mongodb-for-arm.html" target="_blank" rel="noopener">Cross Compile MongoDB for ARM</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pansila.github.io/posts/14894ce3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pansila">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fantasy and Fiction">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/14894ce3/" itemprop="url">Install multi-version cross-compile toolchain on ubuntu</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-22T21:28:40+08:00">2018-03-22</time>
            

            
            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/14894ce3/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments:</span> <span class="post-comments-count valine-comment-count" data-xid="/posts/14894ce3/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>As of ubuntu 17.10, apt source has provided us several cross-compile toolchains for the ARM platform:</p>
<ul>
<li>gcc-5-arm-linux-gnueabihf</li>
<li>gcc-6-arm-linux-gnueabihf</li>
<li>gcc-7-arm-linux-gnueabihf</li>
<li>…</li>
</ul>
<p>After getting them installed, these tools got a suffix number to indicate the version, like  <code>/usr/bin/arm-linux-gnueabihf-gcc-5</code>.</p>
<p>We’d like to specify which one to use as per the project requirement.</p>
<p>Fortunately we can make it easily by using the tool <code>update-alternatives</code> which comes with the ubuntu distribution.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo update-alternatives --install /usr/bin/arm-linux-gnueabihf-gcc arm-linux-gnueabihf-gcc /usr/bin/arm-linux-gnueabihf-gcc-5 100 --slave /usr/bin/arm-linux-gnueabihf-g++ arm-linux-gnueabihf-g++ /usr/bin/arm-linux-gnueabihf-g++-5</span><br></pre></td></tr></table></figure>
<p>Here, we have provided the <code>arm-linux-gnueabihf-gcc</code> as the master and <code>arm-linux-gnueabihf-g++</code> as slave. Multiple slaves can be appended along with master. When master symbolic link is changed, the slaves will be changed too.</p>
<p>Pass the second version of these tools to be recorded:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo update-alternatives --install /usr/bin/arm-linux-gnueabihf-gcc arm-linux-gnueabihf-gcc /usr/bin/arm-linux-gnueabihf-gcc-6 50 --slave /usr/bin/arm-linux-gnueabihf-g++ arm-linux-gnueabihf-g++ /usr/bin/arm-linux-gnueabihf-g++-6</span><br></pre></td></tr></table></figure></p>
<p>Now you can switch between these versions by using:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo update-alternatives --config arm-linux-gnueabihf-gcc</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pansila.github.io/posts/9bf1f09/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pansila">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fantasy and Fiction">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/9bf1f09/" itemprop="url">一个flv.js简单demo</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-02-02T17:02:06+08:00">2018-02-02</time>
            

            
            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/9bf1f09/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments:</span> <span class="post-comments-count valine-comment-count" data-xid="/posts/9bf1f09/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://www.jianshu.com/p/d9c66d7d1653" target="_blank" rel="noopener">参考demo</a></p>
<ol>
<li><p>启动web server</p>
<p>通常我们需要安装apache或者nginx，这里只需要一个简单的静态server就够了，因为flv的解析都在浏览器前端。</p>
<ul>
<li>python 2</li>
</ul>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">python -m SimpleHTTPServer</span></span><br></pre></td></tr></table></figure>
<ul>
<li>python 3</li>
</ul>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">py -m http.<span class="keyword">server</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>把文后的js源文件放到web server根目录</p>
</li>
<li><p>浏览器打开默认的server地址，localhost:8000</p>
<p>这个时候还看不到视频内容，因为媒体文件还没有</p>
</li>
<li><p>用ffmpeg制作一个flv文件</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -f gdigrab -framerate <span class="number">10</span> -<span class="selector-tag">i</span> desktop -vcodec h264 -acodec aac -f flv movie.flv</span><br></pre></td></tr></table></figure>
<p>这里是在录制屏幕并输出到movie.flv，注意要选择编码器，默认的编码flv.js并不支持，然后也放到根目录</p>
<p>默认编码器</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">encoder</span>         : <span class="selector-tag">Lavc57</span><span class="selector-class">.107</span><span class="selector-class">.100</span> <span class="selector-tag">flv</span></span><br></pre></td></tr></table></figure>
<p>指定后</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">encoder</span>         : <span class="selector-tag">Lavc57</span><span class="selector-class">.107</span><span class="selector-class">.100</span> <span class="selector-tag">libx264</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>最后再刷新主页，可以播放视频了</p>
</li>
</ol>
<p><img src="img/2018-02-02_173013.png" alt=""></p>
<hr>
<p>js源文件<br><div><div class="fold_hider"><div class="close hider_title">点击显/隐内容</div></div><div class="fold">
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta content=<span class="string">"text/html; charset=utf-8"</span> http-equiv=<span class="string">"Content-Type"</span>&gt;</span><br><span class="line">    &lt;title&gt;flv.js demo&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">    &lt;style&gt;</span></span><br><span class="line"><span class="regexp">        .mainContainer &#123;</span></span><br><span class="line"><span class="regexp">            display: block;</span></span><br><span class="line"><span class="regexp">            width: 1024px;</span></span><br><span class="line"><span class="regexp">            margin-left: auto;</span></span><br><span class="line"><span class="regexp">            margin-right: auto;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        .urlInput &#123;</span></span><br><span class="line"><span class="regexp">            display: block;</span></span><br><span class="line"><span class="regexp">            width: 100%;</span></span><br><span class="line"><span class="regexp">            margin-left: auto;</span></span><br><span class="line"><span class="regexp">            margin-right: auto;</span></span><br><span class="line"><span class="regexp">            margin-top: 8px;</span></span><br><span class="line"><span class="regexp">            margin-bottom: 8px;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        .centeredVideo &#123;</span></span><br><span class="line"><span class="regexp">            display: block;</span></span><br><span class="line"><span class="regexp">            width: 100%;</span></span><br><span class="line"><span class="regexp">            height: 576px;</span></span><br><span class="line"><span class="regexp">            margin-left: auto;</span></span><br><span class="line"><span class="regexp">            margin-right: auto;</span></span><br><span class="line"><span class="regexp">            margin-bottom: auto;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        .controls &#123;</span></span><br><span class="line"><span class="regexp">            display: block;</span></span><br><span class="line"><span class="regexp">            width: 100%;</span></span><br><span class="line"><span class="regexp">            text-align: left;</span></span><br><span class="line"><span class="regexp">            margin-left: auto;</span></span><br><span class="line"><span class="regexp">            margin-right: auto;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>style&gt;</span><br><span class="line">&lt;<span class="regexp">/head&gt;</span></span><br><span class="line"><span class="regexp">&lt;body&gt;</span></span><br><span class="line"><span class="regexp">    &lt;div class="mainContainer"&gt;</span></span><br><span class="line"><span class="regexp">        &lt;video id="videoElement" class="centeredVideo" controls autoplay width="1024" height="576"&gt;Your browser is too old which doesn't support HTML5 video.&lt;/</span>video&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;br&gt;</span></span><br><span class="line"><span class="regexp">    &lt;div class="controls"&gt;</span></span><br><span class="line"><span class="regexp">        &lt;!--&lt;button onclick="flv_load()"&gt;加载&lt;/</span>button&gt;--&gt;</span><br><span class="line">        &lt;button onclick=<span class="string">"flv_start()"</span>&gt;开始&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onclick="flv_pause()"&gt;暂停&lt;/</span>button&gt;</span><br><span class="line">        &lt;button onclick=<span class="string">"flv_destroy()"</span>&gt;停止&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;input style="width:100px" type="text" name="seekpoint" /</span>&gt;</span><br><span class="line">        &lt;button onclick=<span class="string">"flv_seekto()"</span>&gt;跳转&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">    &lt;script src=<span class="string">"https://cdn.bootcss.com/flv.js/1.4.0/flv.min.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        <span class="keyword">var</span> player = <span class="built_in">document</span>.getElementById(<span class="string">'videoElement'</span>);</span><br><span class="line">        <span class="keyword">if</span> (flvjs.isSupported()) &#123;</span><br><span class="line">            <span class="keyword">var</span> flvPlayer = flvjs.createPlayer(&#123;</span><br><span class="line">                type: <span class="string">'flv'</span>,</span><br><span class="line">                <span class="string">"isLive"</span>: <span class="literal">true</span>,<span class="comment">//&lt;====加个这个</span></span><br><span class="line">                url: <span class="string">'movie.flv'</span>,<span class="comment">//&lt;==自行修改</span></span><br><span class="line"></span><br><span class="line">            &#125;);</span><br><span class="line">            flvPlayer.attachMediaElement(videoElement);</span><br><span class="line">            flvPlayer.load(); <span class="comment">//加载</span></span><br><span class="line">            flv_start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">flv_start</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            player.play();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">flv_pause</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            player.pause();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">flv_destroy</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            player.pause();</span><br><span class="line">            player.unload();</span><br><span class="line">            player.detachMediaElement();</span><br><span class="line">            player.destroy();</span><br><span class="line">            player = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">flv_seekto</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            player.currentTime = <span class="built_in">parseFloat</span>(<span class="built_in">document</span>.getElementsByName(<span class="string">'seekpoint'</span>)[<span class="number">0</span>].value);</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/html&gt;</span></span><br></pre></td></tr></table></figure>

</div></div></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pansila.github.io/posts/1e47c7bd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pansila">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fantasy and Fiction">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/1e47c7bd/" itemprop="url">一个诡异的232串口故障</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-07-29T21:59:04+08:00">2017-07-29</time>
            

            
            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/1e47c7bd/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments:</span> <span class="post-comments-count valine-comment-count" data-xid="/posts/1e47c7bd/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>前段时间收到一块LED显示屏的通讯电路板，有很明显的串口通讯问题，表现就是无收发数据，显示屏无显示，量测TX和RX上也的确没有电平变化。<br><img src="/img/2017-07-29_222557.png" alt="MAX3232电路图"><br>尝试替换MAX3232芯片后，问题依旧，因为以前吃过亏，怀疑买到假货，又替换SP3232，还是趴窝，苦思不得其解，买假货买到怀疑人生。。。<br>过了几天重新制作一批板子，同样的232芯片居然是正常工作的，才反应过来可能是配套电容有问题。回过头又重新观察232串口电路，拿示波器依次量测几颗电容两端的电压，对比正常板子，发现问题板子这几个点位信号幅度大约只有正常板子的一半，但电容两端的信号仍然保持反向对称，只有pin 1和pin 3之间的这颗电容两端，不仅幅度减半，pin 3的信号异常低，只有大约300mV的幅度，遂替换之，问题立马消失。<br>那么这颗电容到底有什么问题呢，上图<br><img src="/img/2017-07-29_222222.jpg" alt="罪魁祸首"><br>大概是某小作坊良心之作，一端的焊盘直接脱落了。。。WTF</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pansila.github.io/posts/ba926855/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pansila">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fantasy and Fiction">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/ba926855/" itemprop="url">ETL利器Kettle数据库同步实战</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-25T18:19:36+08:00">2016-12-25</time>
            

            
            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/ba926855/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments:</span> <span class="post-comments-count valine-comment-count" data-xid="/posts/ba926855/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近有需求在SQL server和MySQL之间数据库同步，在比较多种方案后选择了Kettle，因其开源免费，用户多文档完善，图形化编辑上手容易。这里使用了其最新版本，Pentaho Data Integration 7.0。</p>
<p>具体需求不复杂，要从MySQL数据库一张表定期更新到SQL server数据库。这里面数据库之间的差异，Kettle已经通过SQL语言抽象，所以只要处理表结构的差异和转换，主要是数据类型的转换和值映射。这些转换都使用了<code>Script Values / Mod</code>模块处理。而类型和值都匹配仅字段名不同的转换，可以直接在<code>Insert / Update</code>模块里面映射。</p>
<p>为了便于后续调试，为远程MySQL数据库做了一个本地映射，这里用到了合并模块<code>Merge Rows (diff)</code>和同步模块<code>Synchronize after merge</code>。</p>
<p>首先为这三个数据分别建立连接。从左边设计面板拖出一个表输入模块<code>Table input</code>。<br><img src="/img/2016-12-25_203233.png" alt="Table input"></p>
<p>点击New按钮，为数据库连接配置参数。配置好后可以点下面的Test按钮，测试配置是否正确。为本地备份数据库也如此建立连接。<br><img src="/img/2016-12-25_203404.png" alt="Edit connection for MySQL"><br>这是SQL Server数据库的连接配置。<br><img src="/img/2016-12-25_203821.png" alt="Edit connection for SQL server"><br>注意从官网下载的Kettle缺少这两个数据库的驱动文件。分别是<code>jtds-1.3.1.jar</code>和<code>mysql-connector-java-5.1.40-bin.jar</code>。放到kettle的lib目录下即可。</p>
<p>然后建立远端数据库到本地数据库的映射，同样从左边面板拖出来<code>Merge Rows (diff)</code>，这个模块根据若干Key来检索两边数据，然后根据选定的若干Value来检查数据是否一致，哪边的数据较新，哪边的过时。<br><img src="/img/2016-12-25_202709.png" alt="Merge Rows (diff)"><br>注意这里的<code>Flag fieldname</code>字段，它会作为输出之一送到后续模块，后面会看到它的作用。</p>
<p>接着放上同步模块<code>Synchronize after merge</code>，这里有个坑，可以看到General页旁边还有个Advanced页面，一般这种并排折叠的tab页都是些高级配置，不配置默认就不起作用。然而这里不是，它不配置就无法正常工作。<br><img src="/img/2016-12-25_204752.png" alt="Synchronize after merge"><br><img src="/img/2016-12-25_205129.png" alt="Synchronize after merge Advanced"><br>这是配置后的样子，可以看到前面的flagfield字段的作用，它会保存前面Merge模块的比较结果，有三个值<code>new</code>，<code>changed</code>和<code>deleted</code>，意思是对照远程参考数据库，正在检索的数据是否是新添加的，是否是已经有的数据但是需要更新的，是否是过时的数据需要删除的。</p>
<p>接着来到<code>Script Values / Mod</code>模块，这是整个任务的重点，<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//类型映射，datetime to string可以方便地用内置的JS函数库date2str来完成</span></span><br><span class="line">i_FStartDate = date2str(WRITE_DATE, <span class="string">"yyyy-mm-dd hh:mm:ss"</span>);</span><br><span class="line">i_FCreateDate = i_FStartDate;</span><br><span class="line"><span class="keyword">var</span> d1 = str2date(i_FStartDate, <span class="string">"yyyy-mm-dd hh:mm:ss"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 值映射</span></span><br><span class="line"><span class="keyword">switch</span> (<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">case</span> (PASS_TYPE.equals(<span class="string">"员工车辆"</span>)):</span><br><span class="line">  <span class="comment">// 还可以对数据做一些计算后转换</span></span><br><span class="line">	i_FEndDate = dateAdd(d1, <span class="string">"y"</span>, year(VALID_DATE));</span><br><span class="line">	i_FEndDate = date2str(i_FEndDate, <span class="string">"yyyy-mm-dd hh:mm:ss"</span>);</span><br><span class="line">	i_FCardTypeID = <span class="number">1010</span>;</span><br><span class="line">	<span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> (PASS_TYPE.equals(<span class="string">"客户车辆"</span>)):</span><br><span class="line">	i_FEndDate = dateAdd(d1, <span class="string">"y"</span>, year(VALID_DATE));</span><br><span class="line">	i_FEndDate = date2str(i_FEndDate, <span class="string">"yyyy-mm-dd hh:mm:ss"</span>);</span><br><span class="line">	i_FCardTypeID = <span class="number">1020</span>;</span><br><span class="line">	<span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> (PASS_TYPE.equals(<span class="string">"作业车辆"</span>)):</span><br><span class="line">	i_FEndDate = dateAdd(d1, <span class="string">"y"</span>, year(VALID_DATE));</span><br><span class="line">	i_FEndDate = date2str(i_FEndDate, <span class="string">"yyyy-mm-dd hh:mm:ss"</span>);</span><br><span class="line">	i_FCardTypeID = <span class="number">1030</span>;</span><br><span class="line">	<span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">	i_FEndDate = dateAdd(d1, <span class="string">"y"</span>, year(VALID_DATE));</span><br><span class="line">	i_FEndDate = date2str(i_FEndDate, <span class="string">"yyyy-mm-dd hh:mm:ss"</span>);</span><br><span class="line">	i_FCardTypeID = <span class="number">1020</span>;</span><br><span class="line">	<span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>datetime to string可以方便地用内置的JS函数库date2str来完成，甚至进而可以对数据做一些计算，这里体现了用javascript转换的灵活性，这在<code>Insert / Update</code>是不可能的。 注意转换后的字段，在javascript可以当成普通变量赋值，只要在下面的Fields里面声明过。<br><img src="/img/2016-12-25_210515.png" alt="Script Values / Mod"></p>
<p>最后将处理好的字段和可以直接映射的字段，在<code>Insert /Update</code>里面做好一一映射。这里也有个新手坑，根据look up keys检索不到的数据会被insert到目标数据库，检索到的数据会接着去比较下面的Update fields映射表，值不同的字段会接着去Update，除非后面Update字段指定了N。然而对于没有在Update fields表里出现的字段，该模块即不会去insert也不会去update。这点区别很重要，因为一般数据表都会有一个主键，这个键是不能重复的，如果insert或update时包含了这个字段，会报错该字段无法更新。所以不要把主键或者Identity属性字段放到Update fields里面，让数据库内部自动分配主键，这也适用于其它自动过程控制的字段。<br><img src="/img/2016-12-25_210645.png" alt="Insert / Update"></p>
<p>这样就得到了最终的转换方案。<br><img src="/img/2016-12-25_200159.png" alt="Final solution"></p>
<p>为了定期运行这个转换任务(Transformation)，还要建立Kettle里面的Job任务，也很简单，新建一个job，拖出start模块。设置运行间隔。<br><img src="/img/2016-12-25_213058.png" alt="Job Scheduling"><br>然后拖出Transformation模块，指定之前配置的转换任务文件路径。<br><img src="/img/2016-12-25_213327.png" alt="Transformation"><br>连接两个模块，搞定。<br><img src="/img/2016-12-25_213426.png" alt="Job"></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pansila.github.io/posts/b5946502/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pansila">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fantasy and Fiction">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/b5946502/" itemprop="url">不重装迁移系统到新磁盘</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-24T15:03:36+08:00">2016-12-24</time>
            

            
            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/b5946502/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments:</span> <span class="post-comments-count valine-comment-count" data-xid="/posts/b5946502/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>几年前700多大洋入的浦科特128G SSD 近来愈发觉得不够用，趁着今年双十一终于决定再入一块三星256G SSD，仍然是700多大洋。虽然并不喜欢三星MLC工艺，无奈这么多年过去接口升级换代，当年的mSATA也只有三星还在稳定出货价钱合适。这应该是小黑T420最后一次磁盘升级了。</p>
<p>用了这么多年的系统，装了无数大小软件，实在不想再重装系统，之前从HDD到SSD，使用分区助手的迁移系统功能，轻松完成转换。这次因为系统盘上有双系统，所以并不能直接用”系统迁移到SSD/HDD”，而是选了”扇区到扇区复制”，希望保留双系统配置。当然小黑只有一个mSATA接口，为了完成这次任务，又入了佳翼的mSATA移动硬盘盒。然后选择正确的磁盘，根据提示重启后开始复制，这个过程大概进行了1小时40分钟，因为小黑那个时代还只有USB2.0，接口速度比较慢只有150Mbps，所以可以算出120G*8/150Mbps = 1.8小时。<br><img src="/img/2016-12-24_161700.jpg" alt="JEYI"><br><img src="/img/2016-12-24_162431.png" alt="分区助手复制磁盘"></p>
<p>复制完成后，满怀希望地换上新的SSD，以为开机重启就焕发新生了，前面Clover引导都很正常，然后就碰到下面这个鬼画面。<br><img src="/img/2016-12-24_161500.jpg" alt="0xc000000e"></p>
<p>网上搜索都指向修复<code>\boot\BCD</code>文件，但是首先需要一张系统恢复DVD，而且更关键的是貌似需要重置MBR，而我的MBR已经配置了Clover，当初好不容易搞定三系统，轻易不想再动它。于是继续搜索，意识到系统认为硬件变动了，那体现在BCD里面，就只有分区GUID不同，为新分区重建一个entry应该就可以了。换回旧SSD启动电脑，这里用了EasyBCD来操作，其背后会调用bcdedit.exe来操作BCD文件。首先配置下EasyBCD编辑的BCD文件，然后重启程序让设置生效。这里直接指向了新SSD系统使用的BCD，但是安全起见，最好复制一份出来然后在上面编辑，最后再复制回去。<br><img src="/img/2016-12-24_165701.png" alt="设定BCD文件位置"><br>然后新建启动入口。<br><img src="/img/2016-12-24_155520.png" alt="新建启动项"><br>这里选择了新分区所在的盘符K。</p>
<p>然后用bcdedit.exe(可以在EasyBCD安装目录下找到)找到新建项目的GUID<br><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bcdedit <span class="string">/store</span> &lt;path_to_bcd&gt; <span class="string">/enum</span> all</span><br><span class="line">bcdedit <span class="string">/store</span> &lt;path_to_bcd&gt; <span class="string">/enum</span> all <span class="string">/v</span></span><br></pre></td></tr></table></figure></p>
<p>将盘符改回c盘，设置新建条目为默认启动项。<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bcdedit /store &lt;path_to_bcd&gt; /<span class="builtin-name">set</span> &#123;bootmgr&#125;<span class="built_in"> default </span>&lt;new guid&gt;</span><br><span class="line">bcdedit /store &lt;path_to_bcd&gt; /<span class="builtin-name">set</span> &#123;default&#125; osdevice c:</span><br><span class="line">bcdedit /store &lt;path_to_bcd&gt; /<span class="builtin-name">set</span> &#123;default&#125; device c:</span><br></pre></td></tr></table></figure></p>
<p>因为换到新磁盘启动时，系统分区一般就是c盘。可能有人会疑问为什么新建条目时，不直接选c盘，我的理解是GUID是从分区算出来的，选c盘可能会算出旧分区的GUID，这与我们的要求不符。改完之后重启，还是失败，但是错误原因已经变了，是找不到启动程序winload，而不再是压根都找不到设备，看来猜测靠谱。<br><img src="/img/2016-12-24_161600.jpg" alt="0xc000000e again"></p>
<p>但是明明winload是不会丢的，系统找不到，可能跟多系统有关，引导程序错误地在一个分区搜索winload。继续搜索找到了解决之道，将启动分区从c:改成boot，意思是让引导程序在当前分区寻找winload。重启搞定。<br><figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bcdedit /store &lt;path_to_bcd&gt; /<span class="keyword">set</span> &#123;<span class="keyword">default</span>&#125; <span class="keyword">osdevice</span> <span class="keyword">boot</span></span><br><span class="line"><span class="keyword">bcdedit</span> /store &lt;path_to_bcd&gt; /<span class="keyword">set</span> &#123;<span class="keyword">default</span>&#125; <span class="keyword">device</span> <span class="keyword">boot</span></span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pansila.github.io/posts/cdc301cc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pansila">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fantasy and Fiction">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/cdc301cc/" itemprop="url">完全云端工作</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-08-06T15:04:00+08:00">2016-08-06</time>
            

            
            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/cdc301cc/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments:</span> <span class="post-comments-count valine-comment-count" data-xid="/posts/cdc301cc/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>随着工作环境的增多，工作内容的同步变得越来越麻烦。以前我们拿U盘拷或者网盘共享，现在进入的云时代，如果不考虑隐私问题，托管在云端不失为一个好办法。<br>目前初步计划完成代码部分的云托管，随后拓展到笔记，个人知识库，二进制资料等等。</p>
<ol>
<li><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3>github是首选，如果要托管私人项目，可以选择gitlab。</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Pansila</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">21</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate"> 
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Pansila</span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Gemini</a> v6.0.6</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.0.6"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.0.6"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.0.6"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.0.6"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.6"></script>



  



	





  





  








  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  
  
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(function (item) {
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'qBTseCeEXIm7y4BLwe05EVy9-gzGzoHsz',
        appKey: 'Vo7kIJagaWoBbHKtppisGPj0',
        placeholder: 'Just go go',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  

  

  

  
  

  

  

  

  

</body>
</html>
